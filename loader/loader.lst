mads 2.0.9
   290 					opt l+
    90
    91 				        ;   org $d301
    92 				        ;   .byte $fe
    93
    94 = E400			CHARSET_ADDRESS equ $E400; // same as in intro and game
    95 				          org CHARSET_ADDRESS
    96 FFFF> E400-E7FF> 00 00 +           ins '../StarV/assets/Nvdi8.fnt'
    97 E800			          org $0580
    98
    99 0580-065B> 49 4E 54 52 + introfile .byte c'INTRO   XEX' ; 11 characters ATASCII (8.3 without the dot, space padded)
   100 058B 53 54 41 52 56 20 + gamefile .byte c'STARV   XEX'
   101 0596 00			xBiosIOresult .byte
   102 0597 00			xBiosIOerror .byte
   103
   104
   105 0598			loadfile
   106 0598 A9 00 8D 96 05	          mva #0 xBiosIOresult
   107 059D 8D 97 05		          sta xBiosIOerror
   108 05A0 A0 00		adr1      ldy #0
   109 05A2 A2 00		adr2      ldx #0
   110 05A4 20 06 08		          jsr xBIOS_LOAD_FILE
   111 05A7 90 08		          bcc @+
   112 05A9 8E 97 05		          stx xBiosIOerror
   113 05AC A9 01 8D 96 05	          mva #1 xBiosIOresult
   114 05B1 60			@         rts
   115
   116 05B2			.proc	systemoff
   117
   118 					lda:rne vcount
   119
   120 					sei
   121 					inc nmien
   122 					mva #$fe portb
   123
   124 					rts
   125 				.endp
   126
   127 05B2			.proc	systemon
   128
   129 					lda:rne vcount
   130
   131 					mva #$ff portb
   132 					dec nmien
   133 					cli
   134
   135 					rts
   136 				.endp
   137
   138 				;-------------------------------------------------------------------------------
   139 05B2			dlist
   140 05B2 70 70 70		          .byte DL_BLANK8, DL_BLANK8, DL_BLANK8
   141 05B5 42 BB 05		          .byte DL_MODE_40x24T2 + DL_LMS, a(vmem)
   142 05B8 41 B2 05		          .byte DL_JVB, a(dlist)
   143
   144 05BB			vmem
   145 05BB 00 00 00 00 2C 2F + 	        .byte "    LOADING... Star Vagrant.            "
   146
   147 				;initialize  clc
   148 				;            cld
   149 				;            lda PORTB
   150 				;            ora #$02
   151 				;            sta PORTB
   152 				;            rts
   153
   154 05E3			main
   155
   156 				          ;jsr systemoff
   157
   158
   159 05E3 AD 0B D4		sync     lda VCOUNT
   160 05E6 D0 FB		         bne sync
   161
   162 05E8 A9 E4 8D 09 D4	         mva #.hi(CHARSET_ADDRESS) chbase
   163 05ED A9 1C 8D 17 D0	         mva #28 colpf1
   164 05F2 A9 00 8D 16 D0	         mva #0 colpf0
   165 05F7 A9 00 8D 18 D0	         mva #0 colpf2
   166 05FC A9 00 8D 19 D0	         mva #0 colpf3
   167 0601 A9 00 8D 1A D0	         mva #0 colbak
   168 0606 A9 B2 8D 02 D4 A9 +          mwa #dlist dlistl
   169 0610 A9 21 8D 00 D4	         mva #ANTIC_MODE_NARROW DMACTL
   170
   171 0615 A9 80 8D A1 05	intro    mva <introfile adr1+1
   172 061A A9 05 8D A3 05	         mva >introfile adr2+1
   173 061F 20 98 05		         jsr loadfile
   174
   175
   176 0622 A9 E4 8D 09 D4	         mva #.hi(CHARSET_ADDRESS) chbase
   177 0627 A9 1C 8D 17 D0	         mva #28 colpf1
   178 062C A9 00 8D 16 D0	         mva #0 colpf0
   179 0631 A9 00 8D 18 D0	         mva #0 colpf2
   180 0636 A9 00 8D 19 D0	         mva #0 colpf3
   181 063B A9 00 8D 1A D0	         mva #0 colbak
   182 0640 A9 B2 8D 02 D4 A9 +          mwa #dlist dlistl
   183 064A A9 21 8D 00 D4	         mva #ANTIC_MODE_NARROW DMACTL
   184
   185 064F A9 8B 8D A1 05	game     mva <gamefile adr1+1
   186 0654 A9 05 8D A3 05	         mva >gamefile adr2+1
   187 0659 4C 98 05		         jmp loadfile
   188
   189 				          ;jmp systemon
   190
   191 				;          ini initialize
   192 02E0-02E1> E3 05		          run main
   193
   194 				.print "Loader:", main, "..", *
   194 				Loader:$05E3..$065C
